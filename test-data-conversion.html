<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•æ•°æ®è½¬æ¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .section h3 { margin-top: 0; color: #333; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .error { background: #ffebee; color: #f44336; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª æµ‹è¯•æ•°æ®è½¬æ¢</h1>
        
        <div class="section">
            <h3>ğŸ¯ æµ‹è¯•è¯´æ˜</h3>
            <p>è¿™ä¸ªé¡µé¢æ¨¡æ‹Ÿäº†æ•°æ®è½¬æ¢è¿‡ç¨‹ï¼Œæµ‹è¯•ä»APIæ•°æ®åˆ°Photoæ ¼å¼çš„è½¬æ¢æ˜¯å¦æ­£ç¡®ã€‚</p>
        </div>

        <div class="section">
            <h3>ğŸ”§ æµ‹è¯•æ“ä½œ</h3>
            <button onclick="testConversion()">æµ‹è¯•æ•°æ®è½¬æ¢</button>
            <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // æ¨¡æ‹ŸAPIæ•°æ®
        const mockApiData = {
            id: 14,
            dataset_id: 3,
            original_image_id: null,
            original_filename: "åœ°æ™¯å»ºç­‘_0001.jpg",
            minio_object_name: "dataset_3_20250903_214255/7ad134268e9e423fa6c6d3b8519e1be4.jpg",
            minio_url: "http://192.10.222.123:9000/dataset/dataset_3_20250903_214255/7ad134268e9e423fa6c6d3b8519e1be4.jpg",
            filename: "7ad134268e9e423fa6c6d3b8519e1be4.jpg",
            file_size: 0,
            width: 1920,
            height: 1080,
            format: "JPG",
            type_tags: ["ä½å®…", "ç°ä»£ä¸»ä¹‰", "å‚æ™š", "ä¹¡æ‘", "æ°´è¾¹"],
            phrase_tags: ["è¶…å†™å®ç…§ç‰‡ï¼Œå±±å¡ä¸Šçš„ç°ä»£ä½å®…ï¼Œç‹¬ç‰¹çš„åŠåŸ‹æ¤­åœ†ç»“æ„", "å¤§ç»ç’ƒå¹•å¢™å‘å‡ºæ¸©æš–é»„å…‰"],
            natural_tags: ["è¿™æ˜¯ä¸€å¼ åœ¨å‚æ™šæ—¶åˆ†æ‹æ‘„çš„ç°ä»£ä½å®…çš„è¶…å†™å®ç…§ç‰‡"],
            raw_annotation_data: {},
            annotation_method: "auto",
            annotation_model: null,
            confidence_score: 0.0,
            quality_score: null,
            is_verified: false,
            verification_notes: null,
            image_metadata: null,
            created_at: "2025-09-03T13:42:56",
            updated_at: "2025-09-03T13:42:56"
        };

        // æ¨¡æ‹ŸStoredImageData
        const mockStoredData = {
            id: "photo-14",
            url: "http://192.10.222.123:9000/dataset/dataset_3_20250903_214255/7ad134268e9e423fa6c6d3b8519e1be4.jpg",
            title: "åœ°æ™¯å»ºç­‘_0001",
            description: "è¿™æ˜¯ä¸€å¼ åœ¨å‚æ™šæ—¶åˆ†æ‹æ‘„çš„ç°ä»£ä½å®…çš„è¶…å†™å®ç…§ç‰‡",
            date: "2025-09-03",
            tags: ["ä½å®…", "ç°ä»£ä¸»ä¹‰", "å‚æ™š", "ä¹¡æ‘", "æ°´è¾¹", "JPG", "æ•°æ®é›†3"],
            width: 1920,
            height: 1080,
            format: "JPG",
            source_website: "dataset-3",
            lastUpdated: Date.now(),
            checksum: "123456789",
            // æ–°å¢çš„å…ƒæ•°æ®å­—æ®µ
            filename: "7ad134268e9e423fa6c6d3b8519e1be4.jpg",
            original_filename: "åœ°æ™¯å»ºç­‘_0001.jpg",
            unique_id: 14,
            type_tags: ["ä½å®…", "ç°ä»£ä¸»ä¹‰", "å‚æ™š", "ä¹¡æ‘", "æ°´è¾¹"],
            phrase_tags: ["è¶…å†™å®ç…§ç‰‡ï¼Œå±±å¡ä¸Šçš„ç°ä»£ä½å®…ï¼Œç‹¬ç‰¹çš„åŠåŸ‹æ¤­åœ†ç»“æ„", "å¤§ç»ç’ƒå¹•å¢™å‘å‡ºæ¸©æš–é»„å…‰"]
        };

        // æ¨¡æ‹ŸtoPhotoFormatå‡½æ•°
        function toPhotoFormat(storedImage) {
            return {
                id: storedImage.id,
                url: storedImage.url,
                title: storedImage.title,
                description: storedImage.description,
                date: storedImage.date,
                tags: storedImage.tags,
                width: storedImage.width,
                height: storedImage.height,
                format: storedImage.format,
                source_website: storedImage.source_website,
                // æ–°å¢çš„å…ƒæ•°æ®å­—æ®µ
                filename: storedImage.filename,
                original_filename: storedImage.original_filename,
                unique_id: storedImage.unique_id,
                type_tags: storedImage.type_tags,
                phrase_tags: storedImage.phrase_tags
            };
        }

        function testConversion() {
            const resultsDiv = document.getElementById('results');
            
            try {
                // æµ‹è¯•è½¬æ¢
                const convertedPhoto = toPhotoFormat(mockStoredData);
                
                // æ£€æŸ¥å…³é”®å­—æ®µ
                const checks = [
                    { name: 'original_filename', value: convertedPhoto.original_filename, expected: 'åœ°æ™¯å»ºç­‘_0001.jpg' },
                    { name: 'format', value: convertedPhoto.format, expected: 'JPG' },
                    { name: 'width', value: convertedPhoto.width, expected: 1920 },
                    { name: 'height', value: convertedPhoto.height, expected: 1080 },
                    { name: 'type_tags', value: convertedPhoto.type_tags, expected: ['ä½å®…', 'ç°ä»£ä¸»ä¹‰', 'å‚æ™š', 'ä¹¡æ‘', 'æ°´è¾¹'] },
                    { name: 'phrase_tags', value: convertedPhoto.phrase_tags, expected: ['è¶…å†™å®ç…§ç‰‡ï¼Œå±±å¡ä¸Šçš„ç°ä»£ä½å®…ï¼Œç‹¬ç‰¹çš„åŠåŸ‹æ¤­åœ†ç»“æ„', 'å¤§ç»ç’ƒå¹•å¢™å‘å‡ºæ¸©æš–é»„å…‰'] }
                ];
                
                let html = '<div class="section"><h3>ğŸ§ª è½¬æ¢æµ‹è¯•ç»“æœ</h3>';
                
                let allPassed = true;
                checks.forEach(check => {
                    const passed = JSON.stringify(check.value) === JSON.stringify(check.expected);
                    const status = passed ? 'success' : 'error';
                    const icon = passed ? 'âœ…' : 'âŒ';
                    
                    html += `<div class="test-result ${status}">
                        ${icon} ${check.name}: ${passed ? 'é€šè¿‡' : 'å¤±è´¥'}
                        <br>å®é™…å€¼: ${JSON.stringify(check.value)}
                        <br>æœŸæœ›å€¼: ${JSON.stringify(check.expected)}
                    </div>`;
                    
                    if (!passed) allPassed = false;
                });
                
                html += `<div class="test-result ${allPassed ? 'success' : 'error'}">
                    ${allPassed ? 'âœ…' : 'âŒ'} æ€»ä½“ç»“æœ: ${allPassed ? 'æ‰€æœ‰æµ‹è¯•é€šè¿‡' : 'éƒ¨åˆ†æµ‹è¯•å¤±è´¥'}
                </div>`;
                
                html += '<h4>ğŸ“„ è½¬æ¢åçš„å®Œæ•´æ•°æ®:</h4>';
                html += `<pre>${JSON.stringify(convertedPhoto, null, 2)}</pre>`;
                
                html += '</div>';
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="section"><h3>ğŸ§ª è½¬æ¢æµ‹è¯•ç»“æœ</h3><div class="test-result error">âŒ è½¬æ¢å¤±è´¥: ${error.message}</div></div>`;
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            console.log('ğŸ§ª æ•°æ®è½¬æ¢æµ‹è¯•é¡µé¢å·²åŠ è½½');
            setTimeout(() => {
                testConversion();
            }, 1000);
        };
    </script>
</body>
</html>
