<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼ºåˆ¶åˆ·æ–°æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .section h3 { margin-top: 0; color: #333; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .error { background: #ffebee; color: #f44336; }
        .info { background: #e3f2fd; color: #1976d2; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ å¼ºåˆ¶åˆ·æ–°æµ‹è¯•</h1>
        
        <div class="section">
            <h3>ğŸ¯ æµ‹è¯•è¯´æ˜</h3>
            <p>è¿™ä¸ªé¡µé¢å¸®åŠ©è¯Šæ–­ä¸ºä»€ä¹ˆä¿®æ”¹æ²¡æœ‰ç”Ÿæ•ˆã€‚æˆ‘ä»¬å°†æ£€æŸ¥å¤šä¸ªå¯èƒ½çš„åŸå› ã€‚</p>
        </div>

        <div class="section">
            <h3>ğŸ”§ è¯Šæ–­æ“ä½œ</h3>
            <button onclick="checkDevServer()">æ£€æŸ¥å¼€å‘æœåŠ¡å™¨</button>
            <button onclick="checkFileModification()">æ£€æŸ¥æ–‡ä»¶ä¿®æ”¹æ—¶é—´</button>
            <button onclick="checkBrowserCache()">æ£€æŸ¥æµè§ˆå™¨ç¼“å­˜</button>
            <button onclick="forceReload()">å¼ºåˆ¶é‡æ–°åŠ è½½</button>
            <button onclick="clearAllCache()">æ¸…ç©ºæ‰€æœ‰ç¼“å­˜</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        function checkDevServer() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="section"><h3>ğŸ–¥ï¸ å¼€å‘æœåŠ¡å™¨æ£€æŸ¥</h3><p>æ­£åœ¨æ£€æŸ¥...</p></div>';
            
            fetch('http://localhost:3001')
                .then(response => {
                    if (response.ok) {
                        resultsDiv.innerHTML = '<div class="section"><h3>ğŸ–¥ï¸ å¼€å‘æœåŠ¡å™¨æ£€æŸ¥</h3><div class="test-result success">âœ… å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ (ç«¯å£3001)</div></div>';
                    } else {
                        resultsDiv.innerHTML = '<div class="section"><h3>ğŸ–¥ï¸ å¼€å‘æœåŠ¡å™¨æ£€æŸ¥</h3><div class="test-result error">âŒ å¼€å‘æœåŠ¡å™¨å“åº”å¼‚å¸¸</div></div>';
                    }
                })
                .catch(error => {
                    resultsDiv.innerHTML = `<div class="section"><h3>ğŸ–¥ï¸ å¼€å‘æœåŠ¡å™¨æ£€æŸ¥</h3><div class="test-result error">âŒ å¼€å‘æœåŠ¡å™¨æœªè¿è¡Œ: ${error.message}</div></div>`;
                });
        }

        function checkFileModification() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="section"><h3>ğŸ“ æ–‡ä»¶ä¿®æ”¹æ£€æŸ¥</h3><p>æ­£åœ¨æ£€æŸ¥...</p></div>';
            
            // æ£€æŸ¥å…³é”®æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¿®æ”¹
            const files = [
                'src/components/PhotoNode.vue',
                'src/components/PhotoViz3D.vue',
                'src/services/indexedDBStorage.ts'
            ];
            
            let html = '<div class="section"><h3>ğŸ“ æ–‡ä»¶ä¿®æ”¹æ£€æŸ¥</h3>';
            
            files.forEach(file => {
                html += `<div class="test-result info">ğŸ“„ ${file} - éœ€è¦æ‰‹åŠ¨æ£€æŸ¥æ–‡ä»¶å†…å®¹</div>`;
            });
            
            html += '<div class="test-result info">ğŸ’¡ è¯·æ£€æŸ¥è¿™äº›æ–‡ä»¶æ˜¯å¦åŒ…å«æœ€æ–°çš„ä¿®æ”¹</div>';
            html += '</div>';
            
            resultsDiv.innerHTML = html;
        }

        function checkBrowserCache() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="section"><h3>ğŸ—„ï¸ æµè§ˆå™¨ç¼“å­˜æ£€æŸ¥</h3><p>æ­£åœ¨æ£€æŸ¥...</p></div>';
            
            // æ£€æŸ¥ç¼“å­˜çŠ¶æ€
            const cacheStatus = {
                'localStorage': localStorage.length,
                'sessionStorage': sessionStorage.length,
                'cookies': document.cookie.length,
                'cacheAPI': 'caches' in window ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'
            };
            
            let html = '<div class="section"><h3>ğŸ—„ï¸ æµè§ˆå™¨ç¼“å­˜æ£€æŸ¥</h3>';
            
            Object.entries(cacheStatus).forEach(([key, value]) => {
                html += `<div class="test-result info">${key}: ${value}</div>`;
            });
            
            html += '<div class="test-result info">ğŸ’¡ å¦‚æœç¼“å­˜è¿‡å¤šï¼Œå¯èƒ½éœ€è¦æ¸…ç©º</div>';
            html += '</div>';
            
            resultsDiv.innerHTML = html;
        }

        function forceReload() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="section"><h3>ğŸ”„ å¼ºåˆ¶é‡æ–°åŠ è½½</h3><div class="test-result info">æ­£åœ¨å¼ºåˆ¶é‡æ–°åŠ è½½é¡µé¢...</div></div>';
            
            // å¼ºåˆ¶é‡æ–°åŠ è½½ï¼Œå¿½ç•¥ç¼“å­˜
            setTimeout(() => {
                window.location.reload(true);
            }, 1000);
        }

        function clearAllCache() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="section"><h3>ğŸ§¹ æ¸…ç©ºæ‰€æœ‰ç¼“å­˜</h3><p>æ­£åœ¨æ¸…ç©º...</p></div>';
            
            try {
                // æ¸…ç©ºlocalStorage
                localStorage.clear();
                
                // æ¸…ç©ºsessionStorage
                sessionStorage.clear();
                
                // æ¸…ç©ºIndexedDB
                if ('indexedDB' in window) {
                    indexedDB.deleteDatabase('ImageStorage');
                }
                
                resultsDiv.innerHTML = '<div class="section"><h3>ğŸ§¹ æ¸…ç©ºæ‰€æœ‰ç¼“å­˜</h3><div class="test-result success">âœ… ç¼“å­˜å·²æ¸…ç©ºï¼Œè¯·åˆ·æ–°é¡µé¢</div></div>';
                
                setTimeout(() => {
                    window.location.reload(true);
                }, 2000);
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="section"><h3>ğŸ§¹ æ¸…ç©ºæ‰€æœ‰ç¼“å­˜</h3><div class="test-result error">âŒ æ¸…ç©ºå¤±è´¥: ${error.message}</div></div>`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            console.log('ğŸ”„ å¼ºåˆ¶åˆ·æ–°æµ‹è¯•é¡µé¢å·²åŠ è½½');
            setTimeout(() => {
                checkDevServer();
            }, 1000);
        };
    </script>
</body>
</html>
