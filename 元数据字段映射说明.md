# 📋 元数据字段映射说明

## 🔍 字段映射关系表

| 显示标题 | API字段 | 数据类型 | 示例值 | 说明 |
|---------|---------|----------|--------|------|
| **文件名** | `filename` | string | `7ad134268e9e423fa6c6d3b8519e1be4` | 服务器存储文件名 |
| **原始文件名** | `original_filename` | string | `未知` | 用户上传时的原始文件名 |
| **格式** | `format` | string | `JPG` | 图片文件格式 |
| **图片尺寸** | `width`, `height` | number | `未知` | 图片像素尺寸 |
| **图片唯一标识符** | `id` | number | `photo-14` | 数据库唯一ID |
| **基础分类标签** | `type_tags` | string[] | `无标签` | AI基础分类标签 |
| **描述性短语标签** | `phrase_tags` | string[] | `无标签` | AI描述性短语 |
| **描述** | `natural_tags[0]` | string | 长文本描述 | AI生成的详细描述 |

## 🎯 数据来源优先级

### 描述字段的生成逻辑
```typescript
const description = apiImage.natural_tags && apiImage.natural_tags.length > 0
  ? apiImage.natural_tags[0]  // 优先使用自然语言标签
  : apiImage.phrase_tags && apiImage.phrase_tags.length > 0
  ? apiImage.phrase_tags[0]   // 其次使用短语标签
  : `数据集 ${apiImage.dataset_id} 中的图片`  // 最后使用默认描述
```

### 标签合并逻辑
```typescript
const allTags = [
  ...(apiImage.type_tags || []),      // 基础分类标签
  ...(apiImage.phrase_tags || []),    // 描述性短语标签
  apiImage.format,                    // 文件格式
  `数据集${apiImage.dataset_id}`      // 数据集标识
].filter(tag => tag && tag.length > 0)
```

## 🔧 当前问题分析

### 1. 缺失的字段
- **原始文件名**: API数据中为空
- **图片尺寸**: API数据中width/height为0
- **基础分类标签**: API数据中type_tags为空数组
- **描述性短语标签**: API数据中phrase_tags为空数组

### 2. 可能的原因
- API数据不完整
- AI标注服务未完全处理
- 数据同步问题

## 📊 数据完整性检查

### 完整数据示例
```json
{
  "id": 14,
  "filename": "7ad134268e9e423fa6c6d3b8519e1be4",
  "original_filename": "modern_house_001.jpg",
  "format": "JPG",
  "width": 1920,
  "height": 1080,
  "type_tags": ["建筑", "现代", "住宅"],
  "phrase_tags": ["现代住宅", "山坡建筑", "傍晚拍摄"],
  "natural_tags": ["这是一张在傍晚时分拍摄的现代住宅的超写实照片..."]
}
```

### 当前数据状态
```json
{
  "id": 14,
  "filename": "7ad134268e9e423fa6c6d3b8519e1be4",
  "original_filename": null,
  "format": "JPG",
  "width": 0,
  "height": 0,
  "type_tags": [],
  "phrase_tags": [],
  "natural_tags": ["这是一张在傍晚时分拍摄的现代住宅的超写实照片..."]
}
```

## 🚀 改进建议

### 1. 数据验证
- 检查API返回数据的完整性
- 验证AI标注服务的状态
- 确保所有字段都有正确的值

### 2. 显示优化
- 对于空字段显示更友好的提示
- 添加数据完整性指示器
- 提供数据来源说明

### 3. 错误处理
- 处理缺失字段的情况
- 提供数据修复机制
- 记录数据质量问题
